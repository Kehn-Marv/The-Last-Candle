name: Build Windows Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
      
      - name: Compile Java sources
        shell: cmd
        run: |
          if not exist bin mkdir bin
          javac -cp acm.jar -d bin src\Boilerplate\*.java src\Entity\*.java src\GamePanes\*.java src\Item\*.java
      
      - name: Create JAR manifest
        shell: cmd
        run: |
          echo Main-Class: Boilerplate.MainApplication > manifest.txt
          echo Class-Path: acm.jar >> manifest.txt
      
      - name: Copy resources to bin
        shell: cmd
        run: xcopy /E /I res bin\res
      
      - name: Build JAR file
        shell: cmd
        run: jar cfm TheLastCandle.jar manifest.txt -C bin .
      
      - name: Create release package
        shell: cmd
        run: |
          if not exist release mkdir release
          copy TheLastCandle.jar release\
          copy acm.jar release\
          xcopy /E /I res release\res
          echo @echo off > release\run.bat
          echo java -cp "TheLastCandle.jar;acm.jar" Boilerplate.MainApplication >> release\run.bat
          echo @echo off > release\README.txt
          echo The Last Candle - Horror Adventure Game >> release\README.txt
          echo. >> release\README.txt
          echo To play: Double-click run.bat >> release\README.txt
          echo. >> release\README.txt
          echo Controls: >> release\README.txt
          echo - WASD or Arrow Keys: Move >> release\README.txt
          echo - Mouse: Click items and buttons >> release\README.txt
          echo - ESC: Pause menu >> release\README.txt
      
      - name: Create ZIP archive
        shell: pwsh
        run: Compress-Archive -Path release\* -DestinationPath TheLastCandle-Windows.zip
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: windows-release
          path: "TheLastCandle-Windows.zip"
      
      - name: Create Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: "TheLastCandle-Windows.zip"
          body: |
            # The Last Candle - Windows Release
            
            üïØÔ∏è A psychological horror adventure game built with Kiro AI
            
            ## Quick Start
            1. Download `TheLastCandle-Windows.zip`
            2. Extract the ZIP file
            3. Double-click `run.bat` to play
            
            ## Controls
            - **WASD** or **Arrow Keys**: Move player
            - **Mouse**: Click inventory items and menu buttons
            - **ESC**: Pause menu
            
            ## System Requirements
            - Windows 10 or later
            - Java 11 or higher (download from java.com if needed)
            
            ---
            Built with ‚ù§Ô∏è and Kiro AI for Kiroween Hackathon
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
